<?xml version="1.0"?>
<xsd:schema version="2.0"
            xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
            elementFormDefault="qualified" 
            attributeFormDefault="unqualified" 
            xmlns:tns="http://nexus.github.com/config" 
            xmlns="http://nexus.github.com/config" 
            targetNamespace="http://nexus.github.com/config"
>

    <xsd:element name="configuration" type="tns:Configuration" />

    <xsd:complexType name="Configuration">
        <xsd:sequence>

            <xsd:element name="jdbc" type="tns:JdbcConfig">
                <xsd:annotation>
                    <xsd:documentation>
                        JDBC Settings for node's internal database. 
                        H2 Jdbc drivers are bundled, other jdbc drivers need to 
                        be added to process's class path. 
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
            
            <xsd:element name="server" type="tns:ServerConfig">
                <xsd:annotation>
                    <xsd:documentation>
                        Embedded Http Rest server configuration. 
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
                        
            <xsd:element name="peer" type="tns:Peer" maxOccurs="unbounded">
                <xsd:annotation>
                    <xsd:documentation>
                        Other nodes known but this node.
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
            
            <xsd:element name="privateKey" type="tns:PrivateKey" minOccurs="1"  maxOccurs="1">
                <xsd:annotation>
                    <xsd:documentation>
                        Private key available to this node for decrypting.
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>

            <xsd:element name="publicKey" type="tns:PublicKey" minOccurs="1"  maxOccurs="1">
                <xsd:annotation>
                    <xsd:documentation>
                        Public key available to this node for decrypting.
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>

            <xsd:element name="unixSocketFile" type="tns:Path">
                <xsd:annotation>
                    <xsd:documentation>
                        Unix domain socket file used for geth to commuciate with Nexus. 
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
            
        </xsd:sequence>
    </xsd:complexType>
    

    
    <xsd:complexType name="JdbcConfig">
        <xsd:sequence>
            <xsd:element name="username" type="xsd:string">
                <xsd:annotation>
                    <xsd:documentation>
                        JDBC Username
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
            <xsd:element name="password" type="xsd:string">
                <xsd:annotation>
                    <xsd:documentation>
                        JDBC Password
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
            <xsd:element name="url" type="xsd:string">
                <xsd:annotation>
                    <xsd:documentation>
                        JDBC URL
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
        </xsd:sequence>
        
    </xsd:complexType>
    
    <xsd:complexType name="ServerConfig">

        <xsd:sequence>
            <xsd:element name="port" type="xsd:int">
                <xsd:annotation>
                    <xsd:documentation>
                        Server port to use for rest services
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
            
            <xsd:element name="ssl" type="tns:SslConfig" minOccurs="0" maxOccurs="1" />
            
        </xsd:sequence>
    </xsd:complexType>
    
    <xsd:complexType name="Peer">
        <xsd:sequence>
            <xsd:element name="url" type="xsd:string" />
        </xsd:sequence>
    </xsd:complexType>
    
    <xsd:complexType name="PrivateKey">

        <xsd:sequence>

            <xsd:choice>
                <xsd:element name="path" type="tns:Path">
                    <xsd:annotation>
                        <xsd:documentation>
                            File system  path to private key
                        </xsd:documentation>
                    </xsd:annotation>  
                </xsd:element>
                <xsd:element name="value" type="xsd:anyURI">
                    <xsd:annotation>
                        <xsd:documentation>
                            Private key value
                        </xsd:documentation>
                    </xsd:annotation>
                    
                </xsd:element>  
            </xsd:choice>

            <xsd:element name="password" type="xsd:string">
                <xsd:annotation>
                    <xsd:documentation>
                        Private key password
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
            
        </xsd:sequence>
  
        <xsd:attribute name="type" type="tns:PrivateKeyType">
            <xsd:annotation>
                <xsd:documentation>
                    Private keys can be locked or unlocked. Locked means 
                    that it requires a password.
                </xsd:documentation>
            </xsd:annotation>
        </xsd:attribute>

        <!--         <xsd:assert test="(@type = 'locked' and not(password) = false())" />-->
    </xsd:complexType>
    
    <xsd:simpleType name="PrivateKeyType">
        
        <xsd:restriction base="xsd:string">
            <xsd:enumeration value="locked" />
            <xsd:enumeration value="unlocked" />
        </xsd:restriction>
    </xsd:simpleType>
    
    <xsd:complexType name="PublicKey">
        <xsd:sequence>
            <xsd:choice>
                <xsd:element name="path" type="tns:Path">
                    <xsd:annotation>
                        <xsd:documentation>
                            File system  path to public key
                        </xsd:documentation>
                    </xsd:annotation>
                </xsd:element>
                <xsd:element name="value" type="xsd:anyURI">
                    <xsd:annotation>
                        <xsd:documentation>
                            Public key value
                        </xsd:documentation>
                    </xsd:annotation>
                </xsd:element>
            </xsd:choice>
        </xsd:sequence>
    </xsd:complexType>
    
        
    <xsd:simpleType name="Path">
        <xsd:restriction base="xsd:string" />
    </xsd:simpleType>

    
    <xsd:complexType name="SslConfig">
        
        <xsd:sequence>
            
            <xsd:element name="tls" type="tns:SslAuthenticationMode" />
            
            <xsd:element name="serverKeyStore" type="tns:Path" />
            <xsd:element name="serverKeyStorePassword" type="xsd:string" />
            
            <xsd:element name="serverTrustStore" type="tns:Path" />
            <xsd:element name="serverTrustStorePassword" type="xsd:string" />
            <xsd:element name="serverTrustMode" type="tns:SslTrustMode" />
            
            
            <xsd:element name="clientKeyStore" type="tns:Path" />
            <xsd:element name="clientKeyStorePassword" type="xsd:string" />
            <xsd:element name="clientTrustStore" type="tns:Path" />
            <xsd:element name="clientTrustStorePassword" type="xsd:string" />
            
            <xsd:element name="clientTrustMode" type="tns:SslTrustMode" />
 
            <xsd:element name="knownClientsFile" type="tns:Path">
                <xsd:annotation>
                    <xsd:documentation>
                        File where client certificates are stored. 
                    </xsd:documentation>
                </xsd:annotation>
                
            </xsd:element>
            
            <xsd:element name="knownServersFile" type="tns:Path">
                <xsd:annotation>
                    <xsd:documentation>
                        File where server certificates are stored. 
                    </xsd:documentation>
                </xsd:annotation>
            </xsd:element>
            
        </xsd:sequence>

    </xsd:complexType>
    
    <xsd:simpleType name="SslAuthenticationMode">
        <xsd:restriction base="xsd:string">
            <xsd:enumeration value="STRICT" />
            <xsd:enumeration value="OFF" />
        </xsd:restriction>
    </xsd:simpleType>
    
    <xsd:simpleType name="SslTrustMode">
        <xsd:restriction base="xsd:string">
            <xsd:enumeration value="CA" />
            <xsd:enumeration value="TOFU" />
            <xsd:enumeration value="WHITELIST" />
        </xsd:restriction>
    </xsd:simpleType>
    
    
    
    
</xsd:schema>
