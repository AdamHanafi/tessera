<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="p2pClientFactory" class="com.quorum.tessera.partyinfo.P2pClientFactory" factory-method="newFactory">
        <constructor-arg ref="config" />
    </bean>

    <bean id="p2pClient" factory-bean="p2pClientFactory" factory-method="create">
        <constructor-arg ref="config"/>
    </bean>

    <bean id="partyInfoStore" class="com.quorum.tessera.partyinfo.PartyInfoStore" factory-method="create">
        <constructor-arg value="#{configService.serverUri}"/>
    </bean>

    <!-- Party Info management -->
    <bean name="partyInfoService" class="com.quorum.tessera.partyinfo.PartyInfoServiceImpl">
        <constructor-arg ref="partyInfoStore"/>
        <constructor-arg ref="configService"/>
        <constructor-arg ref="enclave"/>
    </bean>

    <bean id="partyInfoPollerFactory" class="com.quorum.tessera.partyinfo.PartyInfoPollerFactory" factory-method="newFactory">
        <constructor-arg ref="config"/>
    </bean>
    
    <bean id="partyInfoPoller" factory-bean="partyInfoPollerFactory" factory-method="create">
        <constructor-arg ref="partyInfoService"/>
        <constructor-arg ref="config"/>
    </bean>


    <bean name="partyInfoPollExecutor" class="com.quorum.tessera.threading.TesseraScheduledExecutor">
        <constructor-arg>
            <bean class="java.util.concurrent.Executors" factory-method="newSingleThreadScheduledExecutor"/>
        </constructor-arg>
        <constructor-arg ref="partyInfoPoller" />
        <constructor-arg value="2000"/>
        <constructor-arg value="5000"/>
    </bean>
    
</beans>
