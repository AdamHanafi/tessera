<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:tx="http://www.springframework.org/schema/tx" 
       xmlns:context="http://www.springframework.org/schema/context" 
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd 
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
">


    <tx:annotation-driven transaction-manager="jpaTransactionManager" />
    
    <context:component-scan base-package="com.github.nexus" />
    
    
    <bean class="com.github.nexus.api.VersionResource"/>
    <bean class="com.github.nexus.api.UpCheckResource"/>
    <bean class="com.github.nexus.api.TransactionResource">
        <constructor-arg ref="transactionService"/>
    </bean>

    <bean name="transactionService" class="com.github.nexus.service.TransactionServiceImpl">
        <constructor-arg ref="someDAO"/>
    </bean>

    <bean name="someDAO" class="com.github.nexus.dao.SomeDAOImpl">
        <property name="entityManagerFactory" ref="entityManagerFactory"/>
    </bean>
        
    <bean class="com.github.nexus.app.DefaultExceptionMapper" />
    
    <bean id="dataSource" class="org.h2.jdbcx.JdbcDataSource">
        <property name="url" value="jdbc:h2:mem:hello" />
        <property name="user" value="sa" />
        <property name="password" value="" />
    </bean>
    

    <bean id="jpaTransactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
        <property name="entityManagerFactory" ref="entityManagerFactory" />
    </bean>
    
    <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">


        <property name="dataSource" ref="dataSource" />
        <property name="persistenceUnitName" value="nexus" />

        <property name="jpaVendorAdapter">
            <bean class="org.springframework.orm.jpa.vendor.EclipseLinkJpaVendorAdapter">
                <property name="showSql" value="true"/>
                <property name="generateDdl" value="true"/>
                <property name="databasePlatform" value="org.eclipse.persistence.platform.database.H2Platform"/>
            </bean>
        </property>
        <property name="jpaDialect">
            <bean class="org.springframework.orm.jpa.vendor.EclipseLinkJpaDialect" />
        </property>  
        
        <property name="jpaPropertyMap">
            <props>
                <prop key="eclipselink.weaving">false</prop>
                <prop key="eclipselink.logging.level">FINE</prop>
                <prop key="eclipselink.logging.level.sql">FINE</prop>
                <prop key="eclipselink.logging.parameters">true</prop>
                <prop key="eclipselink.logging.logger">JavaLogger</prop>
                <prop key="javax.persistence.schema-generation.database.action">create</prop>
            </props>
        </property>         

    </bean>
    
</beans>
